---
layout: post
title:  "Linger 옵션"
date:   2022-03-07 09:07:59 +0900
categories: Network
---

예전에 작성한 TCP 연결 끊기 글에서 SO_LINGER 옵션에 관한 언급을 했다. <br>
다시 정확히 공부할 겸 책에 기반해서 내용 정리를 하고 넘어 가야겠다.<br>

책에 `SO_Linger 옵션을 설정하면 소켓 송신 버퍼에 미전송 데이터가 있을 때 closesocket() 함수의 리턴 지연 시간을 제어할 수 있다.` 라고 서술되 있다. <br>
<br>
TCP 소켓을 사용하면 closesocket함수의 역할은 2가지가 있다. <br>
<br>
1. 소켓을 닫고 할당된 자원 반환 <br>
2. TCP 프로토콜 수준에서 연결 종료 절차 진행 = 첫 FIN 보내기<br>
<br>
<br>
linger 옵션을 사용하면 closesocket함수의 동작을 제어 할 수 있다. <br>
<br>
1. 정상동작.. 이 가능하지만 이걸 사용할려면 굳이 링거옵션을 안쓰겠지.. <br>
2. 바로 리턴 및 송신 버퍼 데이터 삭제 이후 4웨이 핸드쉐이크 진행 안함 <br>
3. 버퍼에 데이터를 모두 보내고 TCP 정상 종료 후 closesocket 함수 리턴. 지정한 시간 내 모두 보내지 못할 경우 데이터 삭제 후 강제종료. <br>
<br>
<br>
2번 대로 진행 하면 상대로부터 FIN을 받은뒤 남는 timewait 상태를 방지해 소켓을 빠르게 재사용 할 수 있다.<br>
<br>
잘 기억해 놔야지..<br>
<br>
<br>
출처 : TCP/IP 윈도우 소켓 프로그래밍.. 을 보고 해석..<br>
<br>
